<!DOCTYPE html>
<html lang="en-us">

<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>{{{ PRODUCT_NAME }}}</title>
    <link rel="stylesheet" href="style.css">
    <script id="LeChuckAPIjs" src="https://ssl.minijuegosgratis.com/lechuck/js/latest.js" ></script>
</head>

<body>
    <div id="unity-container" class="unity-desktop">
        <canvas id="unity-canvas" tabindex="0"></canvas>
    </div>
    <div id="loading-cover" style="display:none;">
        <div id="unity-loading-bar">
            <div id="unity-progress-bar-empty" style="display: none;">
                <div id="unity-progress-bar-full"></div>
            </div>
        </div>
    </div>
    <div id="unity-webgl-popup" class="unity-webgl-popup hidden">
        <div class="unity-webgl-popup-content">
            <label for="unity-webgl-popup-input">Popup fallback title</label>
            <textarea id="unity-webgl-popup-input" maxlength="280" rows="5"
                placeholder="Popup fallback placeholder..."></textarea>
            <div class="unity-webgl-popup-buttons">
                <button class="unity-webgl-popup-submit">Submit</button>
                <button class="unity-webgl-popup-cancel">Cancel</button>
            </div>
        </div>
    </div>
    <div id="forte-payments-widget-container"></div>
    <!-- GameStore -->
    <script src="/games.list.js"></script>
    <script src="/sdk.loader.js"></script>
    <script>
        if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
            // Mobile device style: fill the whole browser client area with the game canvas:
            const meta = document.createElement("meta");
            meta.name = "viewport";
            meta.content = "width=device-width, height=device-height, initial-scale=1.0, user-scalable=no, shrink-to-fit=yes";
            document.getElementsByTagName("head")[0].appendChild(meta);
        }

        // Built-in variables
        const LOADER_FILENAME = "{{{ LOADER_FILENAME }}}";
        const DATA_FILENAME = "{{{ DATA_FILENAME }}}";
        const FRAMEWORK_FILENAME = "{{{ FRAMEWORK_FILENAME }}}";
        const WORKER_FILENAME = "{{{ WORKER_FILENAME }}}";
        const CODE_FILENAME = "{{{ CODE_FILENAME }}}";
        const SYMBOLS_FILENAME = "{{{ SYMBOLS_FILENAME }}}";
        const COMPANY_NAME = {{{ JSON.stringify(COMPANY_NAME) }}};
        const PRODUCT_NAME = {{{ JSON.stringify(PRODUCT_NAME) }}};
        const PRODUCT_VERSION = {{{ JSON.stringify(PRODUCT_VERSION) }}};

        // Selectors
        const container = document.querySelector("#unity-container");
        const canvas = document.querySelector("#unity-canvas");
        const loadingCover = document.querySelector("#loading-cover");
        const progressBarEmpty = document.querySelector("#unity-progress-bar-empty");
        const progressBarFull = document.querySelector("#unity-progress-bar-full");

        // Game state
        let unityInstance = null;
        let leChuckAPI = null;

        var localLoaderUrl = "Build/{{{ LOADER_FILENAME }}}";
        const config = {
            arguments: [],
            dataUrl: "Build/{{{ DATA_FILENAME }}}",
            frameworkUrl: "Build/{{{ FRAMEWORK_FILENAME }}}",
#if USE_THREADS
            workerUrl: "Build/{{{ WORKER_FILENAME }}}",
#endif
#if USE_WASM
            codeUrl: "Build/{{{ CODE_FILENAME }}}",
#endif
#if SYMBOLS_FILENAME
            symbolsUrl: "Build/{{{ SYMBOLS_FILENAME }}}",
#endif
            streamingAssetsUrl: "StreamingAssets",
            companyName: {{{ JSON.stringify(COMPANY_NAME) }}},
            productName: {{{ JSON.stringify(PRODUCT_NAME) }}},
            productVersion: {{{ JSON.stringify(PRODUCT_VERSION) }}}
        };

        loadingCover.style.display = "";

        if (typeof PLAYgames === "object" && PLAYgames["monanimalmayhem"]) {
            const remoteHostUrl = PLAYgames["monanimalmayhem"].url;
            const loadConfigUrl = remoteHostUrl + "load-config.json";

            fetchRemoteConfig(loadConfigUrl)
                .then(loadConfig => {
                    config.dataUrl = remoteHostUrl + loadConfig.dataUrl;
                    config.frameworkUrl = remoteHostUrl + loadConfig.frameworkUrl;
                    config.codeUrl = remoteHostUrl + loadConfig.codeUrl;
#if MEMORY_FILENAME
                    config.memoryUrl = remoteHostUrl + loadConfig.memoryUrl;
#endif
#if SYMBOLS_FILENAME
                    config.symbolsUrl = remoteHostUrl + loadConfig.symbolsUrl;
#endif
                    config.streamingAssetsUrl = remoteHostUrl + "StreamingAssets";

                    loadUnityInstance(remoteHostUrl + loadConfig.loaderUrl);
                })
                .catch(error => {
                    console.error("Failed to load remote configuration:", error);
                    loadUnityInstance(localLoaderUrl);
                });
        } else {
            loadUnityInstance(localLoaderUrl);
        }

        function fetchRemoteConfig(url) {
            return new Promise((resolve, reject) => {
                const cacheBuster = new Date().getTime();
                const noCacheUrl = `${url}?_=${cacheBuster}`;
                fetch(noCacheUrl)
                    .then(response => response.json())
                    .then(resolve)
                    .catch(reject);
            });
        }

        function loadUnityInstance(loaderUrl) {
            return new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.src = loaderUrl;
                script.onload = () => {
                    createUnityInstance(canvas, config, (progress) => {
                        progressBarEmpty.style.display = "";
                        progressBarFull.style.width = `${100 * progress}%`;
                    }).then((instance) => {
                        unityInstance = instance;
                        loadingCover.style.display = "none";
                        //initializeLeChuckAPI();
                        resolve(instance);
                    }).catch((message) => {
                        alert(message);
                        reject(message);
                    });
                };
                document.body.appendChild(script);
            });
        }

        /*
        // Forte Payments Widget
        window.addEventListener("FortePaymentsBuyVdaSuccess", e => onForteWidgetCallback(true, "BUY_VDA", e.detail));
        window.addEventListener("FortePaymentsBuyNftSuccess", e => onForteWidgetCallback(true, "BUY_NFT", e.detail));
        window.addEventListener("FortePaymentsBuyNftMintSuccess", e => onForteWidgetCallback(true, "BUY_NFT_MINT", e.detail));
        window.addEventListener("FortePaymentsWidgetClosed", e => onForteWidgetCallback(false, "", null));

        function onForteWidgetCallback(success, type, details) {
            unityInstance.SendMessage("PaymentCallbackReceiver", "ReceiveFortePaymentCallback", JSON.stringify({ success, type, details }));
        }

        function openForteWidget(paymentData) {
            (function init() {
                window.initFortePaymentsWidget
                    ? window.initFortePaymentsWidget({
                        containerId: "forte-payments-widget-container",
                        data: JSON.parse(paymentData)
                    })
                    : setTimeout(init, 10);
            })();
        }
        */    
    </script>

    <!-- Comented by FPA.
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
        if (window.Telegram && window.Telegram.WebApp) {
            window.Telegram.WebApp.onEvent("viewportChanged", () => window.scrollTo(0, 0));
        }
    </script>
    <script type="module" async src="https://dev-forte-payments-cdn.pti-dev.cloud/forte-payments-widget.js"></script>
    <script>
        const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
        if (isIOS) {
            const popup = document.getElementById("unity-webgl-popup");
            const textarea = document.getElementById("unity-webgl-popup-input");
            textarea.addEventListener("focus", () => {
                popup.style.paddingBottom = "35vh";
            });
            textarea.addEventListener("blur", () => {
                popup.style.paddingBottom = "0";
            });
        }
    </script>
    -->

    <!-- <script src="//cdn.jsdelivr.net/npm/eruda"></script>
    <script>
        eruda.init()
    </script> -->
</body>

</html>